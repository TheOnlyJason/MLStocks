<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock News and Recommendations</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>Stock News and Sentiment Analysis</h1>
        
        <!-- Search Bar -->
        <form action="/" method="POST">
            <input type="text" name="stock_symbol" id="stock_symbol" placeholder="Enter stock symbol (e.g., TSLA)" required>
            <button type="submit">Search</button>
        </form>

        <!-- Articles Dropdown -->
        <select id="articleDropdown" onchange="showArticleDetails()">
            <option value="">Select an article</option>
            {% for article in articles %}
                <option value="{{ article['url'] }}">{{ article['title'] }}</option>
            {% endfor %}
        </select>

        <div id="articleDetails">
            <p><strong>Summary:</strong></p>
            <p id="articleSummary"></p>

            <p><strong>Recommendation:</strong></p>
            <p id="articleRecommendation"></p>
        </div>

        <div>
            <h2>Sentiment Analysis Pie Chart</h2>
            <img src="data:image/png;base64,{{ pie_chart }}" alt="Recommendation Pie Chart">
        </div>
    </div>

    <script>
        // Convert articles data from Python to JavaScript
        var articles = JSON.parse('{{ articles | tojson | safe }}');
        
        function showArticleDetails() {
            var dropdown = document.getElementById("articleDropdown");
            var selectedArticleUrl = dropdown.value;
            var articleSummary = document.getElementById("articleSummary");
            var articleRecommendation = document.getElementById("articleRecommendation");
            
            if (selectedArticleUrl) {
                // Find the selected article using the URL
                var selectedArticle = articles.find(function(article) {
                    return article.url === selectedArticleUrl;
                });
                
                // Display article details
                if (selectedArticle) {
                    articleSummary.innerText = selectedArticle.summary || "No summary available.";
                    articleRecommendation.innerText = selectedArticle.recommendation + ": " + selectedArticle.reason;
                } else {
                    articleSummary.innerText = "No article found.";
                    articleRecommendation.innerText = "";
                }
            }
        }
    </script>    
</body>
</html>
